# Дневник (Сервис Вконтакте)
Электронный дневник, который заполняют ученики
[TOCM]

Далее:
Токен группы  - это ключ (специальный набор символов) предназначенный для предоставления возможности присоединится другим пользователям к конкретнной группе
Однако надо помнить что имея при себе токен группы не всегда будет возможность присоединиться к ней, т.к. любой из неё участников может сменить токен группы на новый
# API, использующее приложение

 Все запросы делать по адресу `https://api.matveev.app/hw/service_api/request.php`
**Обязательные** GET параметры в каждом из методов:

| name | default | description |
| ----- | ---- | ------ |
| method | **Required** | Имя метода |
| vk_params | **Required** | Все параметры, отдаваемые ВК |

- Любой метод **обязан** возвращать JSON

- Дополнительные параметры в методах посылаются через **POST** метод

# Методы
## Homework.Get - получение ДЗ

 - Параметры: нет
 - Возвращает:  **Массив** дз
 ```
 {
 	"task_id": string,
	"subject": string,
	"homework": string,
	"date": number | string
 }[]
 ```
 -- date в **UNIX** формате
 - Пример: `...?method=homework.Get`
 ### Homework.Add - добавление ДЗ
 - Метод: **POST**
 - Параметры:

| name | type | default | description | 
| ----- | ---- | ------ | ---- |
| subject | string | **Required** | Название предмета |
| hometask | string | **Required** | Текст с заданием |
| timestamp | number | **Required** | Дата, на которое задано задание в формате Unix |

- Возвращает, если задание добавленно:

```
{
	"task_id": string,
	"response": "ok"
}
```
где task_id - **уникальный** инденификатор добавленного задания 

### Homework.Delete - Удаление Задания
- Параметры:

| name | type | default | description |
| ----- | ---- | ------ | ---- |
| id | string &#124; number | **Required** | Инденификатор задания |
- Возвращает, если задание удаленно:

```
{
	"response": "ok"
}
```
### Homework.Edit - Редактирования Задания
- Метод: **POST**
- Параметры:

| name | type | default | description |
| ----- | ---- | ------ | ---- |
| id | string &#124; number | **Required** | Инденификатор задания |
| subject | string | **Required** | Названия предмета |
| hometask | string | **Required** | Текст задания |
- Возвращает, если задание отредактированно:

```
{
	"response": "ok"
}
```
### Group.Join - Присоединение к группе
- Параметры:

name | type | default | description
| ----- | ---- | ------ | ---- |
token | string | **Required** | Токен группы

- Возвращает: 
	- Если токен не верный:
	
```
{
	"error": "invalid token"
}
```
- 
	- Если пользователь успешно присоединился к группе:

```
{
	"response": "ok"
}
```
### group.Leave - Выход из группы
- Параметры: нет
- Возвращает, если пользователь вышел из группы:
 ```
 {
 	"response": "ok"
 }
 ```
 
 ### group.Create - Создание группы
 - Метод: **GET**
 - Параметры: нет
 - Возвращает, если группа создана и пользователь уже в ней:
 
 ```
{
	"response": "ok"
}
```

### group.NewToken - Создание нового токена для группы
- Параметры: нет
- Возвращает, если успешно был изменен токен группы:
 
 ```
{
	"response": "ok"
}
```

### group.GetToken
 - Параметры: нет
 - Возвращает, если пользователь в группе и токен группы успешно получен:
 
 ```
 {
 	"response": "ok",
	"token": string
 }
 ```
 
 где token -- токен группы

### group.GetQR - Получение изображения с QR кодом
- Параметры: нет
- Возвращает **изображение**  c QR кодом

### auth.Check - Проверка авторизации
- Параметры: нет
- Возвращает, если пользователь состоит в группе:

 ```
{
	"response": "ok"
}
```

### user.Register - Регистрация пользователя
- Описание: Необходимо вызывать **единожды** перед работой с любым другим методом для каждого пользователя, который впервые попадает в сервис.
Этот метод также можно вызывать просто в случае ошибки "user not registered" (подробнее ниже).
- Параметры: нет
- Возвращает: **неизвестно**

### error - Логирование ошибки на сервере
- Описание: это специальный метод, который не связан с работой конкретного пользователя и нацелен на анализ и устранение ошибок в сервисе
-  Параметры:

| name | type | default | description |
| ----- | ---- | ------ | ---- |
text | string | **Required** | Развернутый текст ошибки

- Возвращает: **неизвестно**

## Ошибки в методах
В случае, если в методе произошла ошибка, возвращается объект со свойством error:
```
{
	"error": string
}
```
Возможная строка error:

error | причина | рекомендуемые действия
| ----- | ---- | ------ |
database connection is lost | Потеря соединения с базой данных | Повторить запрос
invalid sign | Неправильная подпись пользователя ВК | Убедится, что передаются правильные параметры от ВК
user not registered | Пользователь не зарегистрирован для работы с ним | Вызвать метод **user.Register**
user not in group  | Пользователь не состоит в группе | Сообщить ему о том, что нужно войти в группу. Это можно сделать с помощью **group.Join** или **group.Create**
one of params is not specified | Отсутствие одного или несколько дополнительных параметров | Убедится в правильности вызова метода
user not in the same group with task | Указанн неверный индентификатор задания | Проверить источник данных для id в параметрах вызываемого метода
user is already in group | Пользователь уже в группе | Смысл вызывать **group.Join** или **group.Create**, если пользователь уже в группе?
invalid token | Был передан неверный токен в **group.Join** | Сказать пользователю, что бы использовал уже верный
user has already been in database | Был использован метод **user.Register** без какой-либо нужды на это | Не использовать этот метод просто так
unknown method | API был вызван с несуществующим названием метода | Проверить не опечатались ли вы
- Пример:
```
{
	"error": "invalid token"
}
```
